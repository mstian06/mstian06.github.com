<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="MS.T Notes">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="MS.T Notes">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MS.T Notes">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> MS.T Notes </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">MS.T Notes</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/01/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-01T13:42:47+08:00" content="2016-04-01">
              2016-04-01
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/09/27/hello-jekyll/" itemprop="url">
                  博客迁移至Jekyll
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-09-27T00:00:00+08:00" content="2014-09-27">
              2014-09-27
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id=""><a href="#" class="headerlink" title=""></a></h1><p class="meta">2014.09.27</p>

<p>Hello Jekyll!</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/09/08/modify-android-keystore-alias/" itemprop="url">
                  修改Android签名密码-别名
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-09-08T00:00:00+08:00" content="2014-09-08">
              2014-09-08
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#</p>
<p class="meta">2014.09.08</p>

<p>之前在测试Eclipse ADT的Custom debug keystore自定义调试证书的时候，发过一篇关于调试证书规格的博文 “Eclipse ADT的Custom debug keystore所需证书规格”:<a href="http://blog.k-res.net/archives/1229.html" target="_blank" rel="external">http://blog.k-res.net/archives/1229.html</a> ，提到过自定义调试证书的密码和alias命名以及alias密码都是有规矩的。<br>其实Android应用开发接入各种SDK时会发现，有很多SDK是需要靠package name和keystore的指纹hash来识别的（百度地图SDK、Facebook SDK等等…），这样如果使用默认自动生成的debug keystore的话就会给开发调试工作带来一些麻烦。这时可以通过修改正式的release keystore，生成一份“遵守规矩”的临时自定义调试证书给开发时用，就方便多了，具体方法如下：</p>
<ol>
<li><p>首先当然是先复制一份正式证书出来作为要修改为的临时调试证书。</p>
</li>
<li><p>修改keystore密码的命令(keytool为JDK带的命令行工具)：</p>
</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ keytool -storepasswd -keystore my.keystore</span><br></pre></td></tr></table></figure>
<p>其中，my.keystore是复制出来的证书文件，执行后会提示输入证书的当前密码，和新密码以及重复新密码确认。这一步需要将密码改为android。</p>
<ol>
<li>修改keystore的alias：</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ keytool -changealias -keystore my.keystore -alias my_name -destalias androiddebugkey</span><br></pre></td></tr></table></figure>
<p>这一步中，my_name是证书中当前的alias，-destalias指定的是要修改为的alias，这里按规矩来，改为androiddebugkey！这个命令会先后提示输入keystore的密码和当前alias的密码。</p>
<ol>
<li>修改alias的密码：</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ keytool -keypasswd -keystore my.keystore -alias androiddebugkey</span><br></pre></td></tr></table></figure>
<p>这一步执行后会提示输入keystore密码，alias密码，然后提示输入新的alias密码，同样，按规矩来，改为android！</p>
<p>以上几个操作执行后，my.keystore就是符合规矩的debug keystore了，接着在Eclipse的ADT设置中选中这个custom debug keystore即可.<br>同时还可以看到证书的MD5以及SHA1指纹。</p>
<p>PS：以上3步命令行并没有先后顺序。</p>
<p>参考文章：</p>
<p><a href="http://blog.blundell-apps.com/tut-change-alias-passwords-of-your-android-keystore/#comment-2408" target="_blank" rel="external">[TUT] Change alias passwords of your Android Keystore</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/06/26/android-touch-event-consume/" itemprop="url">
                  Android点击事件分发
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-06-26T00:00:00+08:00" content="2014-06-26">
              2014-06-26
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#</p>
<p class="meta">2014.01.26</p>


<p>首先是点击事件在不同的布局层次中传递的。</p>
<p>理解Down事件再哪个层次被消费（拦截），后续的Move、Up的点击事件如何传递。</p>
<p>其中ViewGroup中onInterceptTouchEvent方法用来对事件作预处理的，对于Down事件返回true表示要消费这个事件，不再向子View传递。</p>
<p><a href="http://blog.csdn.net/guitk/article/details/7057155" target="_blank" rel="external">Android中dispatchTouchEvent, onInterceptTouchEvent, onTouchEvent的理解</a></p>
<p>onInterceptTouchEvent用于改变事件的传递方向。决定传递方向的是返回值，返回为false时事件会传递给子控件，返回值为true时事件会传递给当前控件的onTouchEvent()，这就是所谓的Intercept(拦截)。</p>
<p>[tisa ps:正确的使用方法是，在此方法内仅判断事件是否需要拦截，然后返回。即便需要拦截也应该直接返回true，然后由onTouchEvent方法进行处理。]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">onTouchEvent用于处理事件，返回值决定当前控件是否消费（consume）了这个事件。尤其对于ACTION_DOWN事件，返回true，表示我想要处理后续事件；返回false，表示不关心此事件，并返回由父类进行处理。</span><br><span class="line">可能你要问是否消费了又区别吗，反正我已经针对事件编写了处理代码？答案是有区别！比如ACTION_MOVE或者ACTION_UP发生的前提是一定曾经发生了ACTION_DOWN，如果你没有消费ACTION_DOWN，那么系统会认为ACTION_DOWN没有发生过，所以ACTION_MOVE或者ACTION_UP就不能被捕获。</span><br></pre></td></tr></table></figure>
<p>在没有重写onInterceptTouchEvent()和onTouchEvent()的情况下(他们的返回值都是false), 对上面这个布局，MotionEvent事件的传递顺序如下：</p>
<p><img src="/assert/26014114_URgH.jpg" alt="Creative Commons License"></p>
<p>当某个控件的onInterceptTouchEvent()返回值为true时，就会发生截断，事件被传到当前控件的onTouchEvent()。如我们将LayoutView2的onInterceptTouchEvent()返回值为true,则传递流程变成：</p>
<p><img src="/assert/26014114_1lGc.jpg" alt=""></p>
<p> 如果我们同时将LayoutView2的onInterceptTouchEvent()和onTouchEvent()设置成true，那么LayoutView2将消费被传递的事件，同时后续事件（如跟着ACTION_DOWN的ACTION_MOVE或者ACTION_UP）会直接传给LayoutView2的onTouchEvent(),不传给其他任何控件的任何函数。同时传递给子空间一个ACTION_CANCEL事件。传递流程变成（图中没有画出ACTION_CANCEL事件）：</p>
<p><img src="/assert/26014114_076W.jpg" alt=""></p>
<p> [tisa ps:总体来看， onInterceptTouchEvent是自rootview向下传递, onTouchEvent正好相反。]</p>
<p>基于以上点击事件的传递，可以重写一些ViewGroup，响应其拖动的事件，比如LinearLayout，重写其onInterceptTouchEvent()和onTouchEvent()两个方法可以达到效果（具体看实际布局中子view对事件的消费情况而定）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//true是拦截，false是不拦截。这里只是预处理判断点击的位置，不拦截。</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ev.getAction() == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = (<span class="keyword">int</span>) ev.getX();</span><br><span class="line">            <span class="keyword">int</span> y = (<span class="keyword">int</span>) ev.getY();</span><br><span class="line"> </span><br><span class="line">            dragSrcPointY = y;</span><br><span class="line"> </span><br><span class="line">            FTLog.d(_TAG, <span class="string">"x="</span> + x + <span class="string">",y="</span> + y);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onInterceptTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//只有判断是点击触发拖动的区域时，才进行处理。否则不处理，交予FTBounceListView旧逻辑处理。</span></span><br><span class="line">            <span class="keyword">int</span> action = ev.getAction();</span><br><span class="line">            <span class="keyword">switch</span> (action) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line"><span class="comment">//              FTLog.e("TMS===down==", "tms");</span></span><br><span class="line"><span class="comment">//              bConsumeDown = true;</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"><span class="comment">//          case MotionEvent.ACTION_MOVE:</span></span><br><span class="line"><span class="comment">//              FTLog.e("TMS===move==", "tms");</span></span><br><span class="line"><span class="comment">//              if (bConsumeDown == false)</span></span><br><span class="line"><span class="comment">//              &#123;</span></span><br><span class="line"><span class="comment">//                  super.onTouchEvent(ev);</span></span><br><span class="line"><span class="comment">//              &#125;</span></span><br><span class="line"><span class="comment">//              break;</span></span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                 </span><br><span class="line">                FTLog.d(_TAG, <span class="string">"x="</span>+ev.getX()+<span class="string">",y="</span>+ev.getY());</span><br><span class="line">                <span class="keyword">if</span> (ev.getY() &lt; dragSrcPointY - <span class="number">20</span>)</span><br><span class="line">                &#123;<span class="comment">//向上拖动距离超过20dip，才finish，动画效果。</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        ((Activity) context).finish();</span><br><span class="line">                        ((Activity) context).overridePendingTransition(</span><br><span class="line">                                R.anim.move_bottom_in, R.anim.move_top_out);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(ev);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>其他视具体情况而定，比如listview的最后一条，某中间区域响应拖动的事件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//true是拦截，false是不拦截。这里只是预处理判断点击的位置，不拦截。</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span> (ev.getAction() == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">            bConsumeDown = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">int</span> x = (<span class="keyword">int</span>) ev.getX();</span><br><span class="line">            <span class="keyword">int</span> y = (<span class="keyword">int</span>) ev.getY();</span><br><span class="line"> </span><br><span class="line">            dragSrcPosition = pointToPosition(x, y);</span><br><span class="line">            dragSrcPointY = y;</span><br><span class="line">            <span class="keyword">if</span> (dragSrcPosition == AdapterView.INVALID_POSITION) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.onInterceptTouchEvent(ev);</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            FTLog.d(_TAG, <span class="string">"x="</span> + x + <span class="string">",y="</span> + y);</span><br><span class="line">            FTLog.d(_TAG, <span class="string">"dragSrcPosition=="</span> + dragSrcPosition</span><br><span class="line">                    + <span class="string">"getAdapter().getCount()=="</span> + getAdapter().getCount());</span><br><span class="line">            <span class="keyword">if</span> (dragSrcPosition == getAdapter().getCount() - <span class="number">1</span></span><br><span class="line">                    || dragSrcPosition == getAdapter().getCount() - <span class="number">2</span>) </span><br><span class="line">            &#123;<span class="comment">// 最后一条是footer，倒数第二条是数据</span></span><br><span class="line">                ViewGroup itemView = (ViewGroup) getChildAt(dragSrcPosition</span><br><span class="line">                        - getFirstVisiblePosition());</span><br><span class="line">                <span class="keyword">int</span> itemLeft = itemView.getLeft();</span><br><span class="line">                <span class="keyword">int</span> itemRight = itemView.getRight();</span><br><span class="line">                <span class="keyword">int</span> itemMid = (itemRight + itemLeft) / <span class="number">2</span>;</span><br><span class="line"> </span><br><span class="line">                FTLog.d(_TAG, <span class="string">"itemLeft=="</span> + itemLeft + <span class="string">", itemRight="</span></span><br><span class="line">                        + itemRight + <span class="string">",itemMid="</span> + itemMid);</span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span> (x &gt; itemMid - <span class="number">60</span> &amp;&amp; x &lt; itemMid + <span class="number">60</span>) &#123;</span><br><span class="line">                    bConsumeDown = <span class="keyword">true</span>;<span class="comment">//预处理，判断是点击触发拖动的区域，并不拦截事件</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onInterceptTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 触摸事件</span><br><span class="line">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (bConsumeDown == <span class="keyword">true</span> &amp;&amp; dragSrcPosition != INVALID_POSITION) &#123;</span><br><span class="line">            <span class="comment">//只有判断是点击触发拖动的区域时，才进行处理。否则不处理，交予FTBounceListView旧逻辑处理。</span></span><br><span class="line">            <span class="keyword">int</span> action = ev.getAction();</span><br><span class="line">            <span class="keyword">switch</span> (action) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line"><span class="comment">//              FTLog.e("TMS===down==", "tms");</span></span><br><span class="line"><span class="comment">//              bConsumeDown = true;</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"><span class="comment">//          case MotionEvent.ACTION_MOVE:</span></span><br><span class="line"><span class="comment">//              FTLog.e("TMS===move==", "tms");</span></span><br><span class="line"><span class="comment">//              if (bConsumeDown == false)</span></span><br><span class="line"><span class="comment">//              &#123;</span></span><br><span class="line"><span class="comment">//                  super.onTouchEvent(ev);</span></span><br><span class="line"><span class="comment">//              &#125;</span></span><br><span class="line"><span class="comment">//              break;</span></span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                 </span><br><span class="line">                FTLog.d(_TAG, <span class="string">"x="</span>+ev.getX()+<span class="string">",y="</span>+ev.getY());</span><br><span class="line">                <span class="keyword">if</span> (ev.getY() &lt; dragSrcPointY - <span class="number">20</span>)</span><br><span class="line">                &#123;<span class="comment">//向上拖动距离超过20dip，才finish，动画效果。</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        ((Activity) context).finish();</span><br><span class="line">                        ((Activity) context).overridePendingTransition(</span><br><span class="line">                                R.anim.move_bottom_in, R.anim.move_top_out);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(ev);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>以上重写ViewGroup的两个方法，对于具体的View来讲，可以setOnTouchLinstener方法，再其OnTouch方法中，用mGestureDetectorOpen.onTouchEvent(event);来响应。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">_imageview_room_op_item_open.setOnTouchListener(<span class="keyword">new</span> OnTouchListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">                mGestureDetectorOpen.onTouchEvent(event);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">         </span><br><span class="line">        mGestureDetectorOpen = <span class="keyword">new</span> GestureDetector(<span class="keyword">this</span>, <span class="keyword">new</span> OnGestureListener()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onFling</span><span class="params">(MotionEvent e1, MotionEvent e2, <span class="keyword">float</span> velocityX,</span><br><span class="line">                    <span class="keyword">float</span> velocityY)</span> </span>&#123;<span class="comment">//判断在_imageview_room_op_item_open控件上移动的距离，do something&#125;</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/01/05/apply-appstore-us-account/" itemprop="url">
                  AppStore美国区账号
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-01-05T00:00:00+08:00" content="2014-01-05">
              2014-01-05
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id=""><a href="#" class="headerlink" title=""></a></h1><p class="meta">2014.01.05</p>


<p>不得不吐槽一下，申请一个美国去账号好麻烦啊！折腾了一晚上，自己的步骤记录如下：</p>
<p><strong>1. 连上iTunes的时候，选择美国区，随便找一个free的app下载，这时候选择注册apple id。一系列步骤中，在够信用卡的时候选None。</strong></p>
<p><img src="/assert/cbc17b380cd7912345bdd90faf345982b2b78029.jpg" alt="Alt text"></p>
<p>网上也有很多参考：</p>
<p><a href="http://jingyan.baidu.com/article/f96699bba4ebc3894e3c1bbe.html" target="_blank" rel="external">怎么注册美国iTunes ID、苹果账号</a></p>
<p>这样注册后就可以用这个账号安装app了。</p>
<p>关键是只能用这一次，后面再选美国区的app下载，还是不行，还是会弹出让你绑定信用卡。</p>
<p><strong>2. 绑定国际信用卡</strong></p>
<p>还是老老实实绑定信用卡吧，自己试的没别的办法。</p>
<p>网上搜的月光博客的资料</p>
<p><a href="http://www.williamlong.info/archives/3464.html" target="_blank" rel="external">使用虚拟信用卡进行国际支付</a></p>
<p>没有国际信用卡，只能用财付通的国外支付功能了，就是财付通与美国运通合作，我们进行海购时给我们虚拟出来的信用卡。</p>
<p>注意再填写上面绑定信用卡的时候，一定要使用美国的ip地址（VPN吧），选择美国运通，</p>
<p>填写 财付通虚拟出来的信用卡卡号，虚拟安全码，虚拟信用卡对应的账单地址。</p>
<p>这些都要填对，因为苹果要从信用卡中扣取1美元用于测信用卡的可用，网上说后续会返还，自己测试上面填好提交之后，财付通被冻结了6.14元。</p>
<p>后面这个账号就可以在itunes上下载安装美国区的app了！</p>
<p>总之：申请美国账号还是待老老实实绑定信用卡吧！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/01/04/android-root-install/" itemprop="url">
                  Android-Root静默安装
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-01-04T00:00:00+08:00" content="2014-01-04">
              2014-01-04
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#</p>
<p class="meta">2014.01.04</p>

<p>说明：用于简单记录。</p>
<p><strong>1.请求root权限，root权限静默安装</strong></p>
<p>请求root</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>     <span class="comment">// 请求root权限，用这个请求root权限，等待授权管理返回</span></span><br><span class="line"> <span class="number">2</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">upgradeRootPermission2</span><span class="params">(String pkgCodePath)</span> </span>&#123;</span><br><span class="line"> <span class="number">3</span>         String cmd=<span class="string">"chmod 777 "</span> + pkgCodePath;</span><br><span class="line"> <span class="number">4</span>         Process process = <span class="keyword">null</span>; </span><br><span class="line"> <span class="number">5</span>         DataOutputStream os = <span class="keyword">null</span>; </span><br><span class="line"> <span class="number">6</span>         BufferedReader br = <span class="keyword">null</span>;</span><br><span class="line"> <span class="number">7</span>         StringBuilder sb = <span class="keyword">null</span>;</span><br><span class="line"> <span class="number">8</span>         <span class="keyword">try</span> &#123;</span><br><span class="line"> <span class="number">9</span>             process = Runtime.getRuntime().exec(<span class="string">"su"</span>);</span><br><span class="line"><span class="number">10</span>             os = <span class="keyword">new</span> DataOutputStream(process.getOutputStream());</span><br><span class="line"><span class="number">11</span>             os.writeBytes(cmd + <span class="string">"\n"</span>);</span><br><span class="line"><span class="number">12</span>             os.writeBytes(<span class="string">"echo return\n"</span>);</span><br><span class="line"><span class="number">13</span>             os.writeBytes(<span class="string">"exit\n"</span>);</span><br><span class="line"><span class="number">14</span>             br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(</span><br><span class="line"><span class="number">15</span>                     process.getInputStream()));</span><br><span class="line"><span class="number">16</span> </span><br><span class="line"><span class="number">17</span>             sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"><span class="number">18</span>             String temp = <span class="keyword">null</span>;</span><br><span class="line"><span class="number">19</span>             <span class="keyword">while</span> ((temp = br.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="number">20</span>                 sb.append(temp + <span class="string">"\n"</span>);</span><br><span class="line"><span class="number">21</span>                 CLog.e(<span class="string">"TMS"</span>, <span class="string">"temp=="</span>+temp);</span><br><span class="line"><span class="number">22</span>                 <span class="keyword">if</span> (<span class="string">"return"</span>.equalsIgnoreCase(temp)) &#123;</span><br><span class="line"><span class="number">23</span>                     CLog.e(<span class="string">"TMS"</span>, <span class="string">"----------"</span> + sb.toString());</span><br><span class="line"><span class="number">24</span>                     <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"><span class="number">25</span>                 &#125;</span><br><span class="line"><span class="number">26</span>             &#125;</span><br><span class="line"><span class="number">27</span>             process.waitFor();</span><br><span class="line"><span class="number">28</span>         &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"><span class="number">29</span>             CLog.e(<span class="string">"TMS"</span>, <span class="string">"异常："</span> + e.getMessage());</span><br><span class="line"><span class="number">30</span>         &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="number">31</span>             <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">32</span>                 <span class="keyword">if</span> (os != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="number">33</span>                     os.flush();</span><br><span class="line"><span class="number">34</span>                     os.close();</span><br><span class="line"><span class="number">35</span>                 &#125;</span><br><span class="line"><span class="number">36</span>                 <span class="keyword">if</span> (br != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="number">37</span>                     br.close();</span><br><span class="line"><span class="number">38</span>                 &#125;</span><br><span class="line"><span class="number">39</span>                 process.destroy();</span><br><span class="line"><span class="number">40</span>             &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"><span class="number">41</span>                 <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"><span class="number">42</span>             &#125;</span><br><span class="line"><span class="number">43</span>         &#125;</span><br><span class="line"><span class="number">44</span>         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"><span class="number">45</span>     &#125;</span><br></pre></td></tr></table></figure>
<p>root安装</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>     <span class="comment">/**</span><br><span class="line"> 2      * 请求ROOT权限后执行命令（最好开启一个线程）</span><br><span class="line"> 3      * <span class="doctag">@param</span> cmd    (pm install -r *.apk)</span><br><span class="line"> 4      * <span class="doctag">@return</span></span><br><span class="line"> 5      */</span></span><br><span class="line"> <span class="number">6</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">installApkInRoot</span><span class="params">(File path, Context context)</span> </span>&#123;</span><br><span class="line"> <span class="number">7</span>         String cmd = <span class="string">"pm install -r "</span> + path + <span class="string">"\n"</span>;</span><br><span class="line"> <span class="number">8</span>         Process process = <span class="keyword">null</span>; </span><br><span class="line"> <span class="number">9</span>         DataOutputStream os = <span class="keyword">null</span>; </span><br><span class="line"><span class="number">10</span>         BufferedReader br = <span class="keyword">null</span>;</span><br><span class="line"><span class="number">11</span>         StringBuilder sb = <span class="keyword">null</span>;</span><br><span class="line"><span class="number">12</span>         <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">13</span>             process = Runtime.getRuntime().exec(<span class="string">"su"</span>);</span><br><span class="line"><span class="number">14</span>             os = <span class="keyword">new</span> DataOutputStream(process.getOutputStream());</span><br><span class="line"><span class="number">15</span>             os.writeBytes(cmd + <span class="string">"\n"</span>);</span><br><span class="line"><span class="number">16</span>             os.writeBytes(<span class="string">"exit\n"</span>);</span><br><span class="line"><span class="number">17</span>             br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(</span><br><span class="line"><span class="number">18</span>                     process.getInputStream()));</span><br><span class="line"><span class="number">19</span> </span><br><span class="line"><span class="number">20</span>             sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"><span class="number">21</span>             String temp = <span class="keyword">null</span>;</span><br><span class="line"><span class="number">22</span>             <span class="keyword">while</span> ((temp = br.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="number">23</span>                 sb.append(temp + <span class="string">"\n"</span>);</span><br><span class="line"><span class="number">24</span>                 CLog.e(<span class="string">"TMS"</span>, <span class="string">"temp=="</span>+temp);</span><br><span class="line"><span class="number">25</span>                 <span class="keyword">if</span> (<span class="string">"Success"</span>.equalsIgnoreCase(temp)) &#123;</span><br><span class="line"><span class="number">26</span>                     CLog.e(<span class="string">"TMS"</span>, <span class="string">"----------"</span> + sb.toString());</span><br><span class="line"><span class="number">27</span>                     <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"><span class="number">28</span>                 &#125;</span><br><span class="line"><span class="number">29</span>             &#125;</span><br><span class="line"><span class="number">30</span>             process.waitFor();</span><br><span class="line"><span class="number">31</span>         &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"><span class="number">32</span>             CLog.e(<span class="string">"TMS"</span>, <span class="string">"异常："</span> + e.getMessage());</span><br><span class="line"><span class="number">33</span>         &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="number">34</span>             <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">35</span>                 <span class="keyword">if</span> (os != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="number">36</span>                     os.flush();</span><br><span class="line"><span class="number">37</span>                     os.close();</span><br><span class="line"><span class="number">38</span>                 &#125;</span><br><span class="line"><span class="number">39</span>                 <span class="keyword">if</span> (br != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="number">40</span>                     br.close();</span><br><span class="line"><span class="number">41</span>                 &#125;</span><br><span class="line"><span class="number">42</span>                 process.destroy();</span><br><span class="line"><span class="number">43</span>             &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"><span class="number">44</span>                 <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"><span class="number">45</span>             &#125;</span><br><span class="line"><span class="number">46</span>         &#125;</span><br><span class="line"><span class="number">47</span>         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"><span class="number">48</span>     &#125;</span><br></pre></td></tr></table></figure>
<p>h2. 2. 永久获取root权限</p>
<p>实现原理是第一次请求root权限时，将自己编译的su 拷贝到system/bin目录，后续在进行root权限操作时，调用自己的su。</p>
<p>91手机助手类似如此，一次请求，永久取得root权限。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span>     <span class="comment">/**</span><br><span class="line"> 2      * 调用su获取root权限再把zlsu写到system/bin目录下</span><br><span class="line"> 3      * 以便永久获取root权限（一旦获取成功，下次不再调用su）</span><br><span class="line"> 4      * </span><br><span class="line"> 5      * <span class="doctag">@param</span> ctx</span><br><span class="line"> 6      */</span></span><br><span class="line"> <span class="number">7</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">preparezlsu</span><span class="params">(Context ctx)</span> </span>&#123;</span><br><span class="line"> <span class="number">8</span>         <span class="keyword">try</span> &#123;</span><br><span class="line"> <span class="number">9</span>             File zlsu = <span class="keyword">new</span> File(<span class="string">"/system/bin/"</span> + Constants.ROOT_SU);</span><br><span class="line"><span class="number">10</span>             <span class="comment">// if (!zlsu.exists())</span></span><br><span class="line"><span class="number">11</span>             <span class="comment">// &#123;</span></span><br><span class="line"><span class="number">12</span>             <span class="comment">// Toast toast = Toast.makeText(ctx,</span></span><br><span class="line"><span class="number">13</span>             <span class="comment">// "Unable to find /system/bin/zlsu.", Toast.LENGTH_LONG);</span></span><br><span class="line"><span class="number">14</span>             <span class="comment">// toast.show();</span></span><br><span class="line"><span class="number">15</span>             <span class="comment">// return;</span></span><br><span class="line"><span class="number">16</span>             <span class="comment">// &#125;</span></span><br><span class="line"><span class="number">17</span> </span><br><span class="line"><span class="number">18</span>             InputStream suStream = ctx.getResources().openRawResource(</span><br><span class="line"><span class="number">19</span>                     R.raw.zlsu);</span><br><span class="line"><span class="number">20</span>             <span class="comment">/**</span><br><span class="line">21              * 如果zlsu存在，则和raw目录下的zlsu比较大小，大小相同则不替换</span><br><span class="line">22              */</span></span><br><span class="line"><span class="number">23</span>             <span class="keyword">if</span> (zlsu.exists()) &#123;</span><br><span class="line"><span class="number">24</span>                 <span class="keyword">if</span> (zlsu.length() == suStream.available()) &#123;</span><br><span class="line"><span class="number">25</span>                     suStream.close();</span><br><span class="line"><span class="number">26</span>                     <span class="keyword">return</span>;</span><br><span class="line"><span class="number">27</span>                 &#125;</span><br><span class="line"><span class="number">28</span>             &#125;</span><br><span class="line"><span class="number">29</span> </span><br><span class="line"><span class="number">30</span>             <span class="comment">// File superuser = new File("/system/bin/superuser");</span></span><br><span class="line"><span class="number">31</span>             <span class="comment">//</span></span><br><span class="line"><span class="number">32</span>             <span class="comment">// if (superuser.exists())</span></span><br><span class="line"><span class="number">33</span>             <span class="comment">// &#123;</span></span><br><span class="line"><span class="number">34</span>             <span class="comment">// // return device to original state</span></span><br><span class="line"><span class="number">35</span>             <span class="comment">// Process process = Runtime.getRuntime().exec("superuser");</span></span><br><span class="line"><span class="number">36</span>             <span class="comment">// DataOutputStream os = new</span></span><br><span class="line"><span class="number">37</span>             <span class="comment">// DataOutputStream(process.getOutputStream());</span></span><br><span class="line"><span class="number">38</span>             <span class="comment">//</span></span><br><span class="line"><span class="number">39</span>             <span class="comment">// os.writeBytes("mount -oremount,rw /dev/block/mtdblock3 /system\n");</span></span><br><span class="line"><span class="number">40</span>             <span class="comment">// os.writeBytes("busybox cp /system/bin/superuser /system/bin/su\n");</span></span><br><span class="line"><span class="number">41</span>             <span class="comment">// os.writeBytes("busybox chown 0:0 /system/bin/su\n");</span></span><br><span class="line"><span class="number">42</span>             <span class="comment">// os.writeBytes("chmod 4755 /system/bin/su\n");</span></span><br><span class="line"><span class="number">43</span>             <span class="comment">// os.writeBytes("rm /system/bin/superuser\n");</span></span><br><span class="line"><span class="number">44</span>             <span class="comment">// os.writeBytes("exit\n");</span></span><br><span class="line"><span class="number">45</span>             <span class="comment">// os.flush();</span></span><br><span class="line"><span class="number">46</span>             <span class="comment">// &#125;</span></span><br><span class="line"><span class="number">47</span> </span><br><span class="line"><span class="number">48</span>             <span class="comment">/**</span><br><span class="line">49              * 先把zlsu 写到/data/data/com.zl.movepkgdemo中 然后再调用 su 权限 写到</span><br><span class="line">50              * /system/bin目录下</span><br><span class="line">51              */</span></span><br><span class="line"><span class="number">52</span>             <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[suStream.available()];</span><br><span class="line"><span class="number">53</span>             DataInputStream dis = <span class="keyword">new</span> DataInputStream(suStream);</span><br><span class="line"><span class="number">54</span>             dis.readFully(bytes);</span><br><span class="line"><span class="number">55</span>             String pkgPath = ctx.getApplicationContext()</span><br><span class="line"><span class="number">56</span>                     .getPackageName();</span><br><span class="line"><span class="number">57</span>             <span class="comment">// "/data/data/com.zl.movepkgdemo/zlsu"</span></span><br><span class="line"><span class="number">58</span>             String zlsuPath = <span class="string">"/data/data/"</span> + pkgPath + File.separator + Constants.ROOT_SU;</span><br><span class="line"><span class="number">59</span>             File zlsuFileInData = <span class="keyword">new</span> File(zlsuPath);</span><br><span class="line"><span class="number">60</span>             <span class="keyword">if</span>(!zlsuFileInData.exists())&#123;</span><br><span class="line"><span class="number">61</span>                 System.out.println(zlsuPath + <span class="string">" not exist! "</span>);</span><br><span class="line"><span class="number">62</span>                 <span class="keyword">try</span>&#123;</span><br><span class="line"><span class="number">63</span>                 System.out.println(<span class="string">"creating "</span>+zlsuPath + <span class="string">"......"</span>);</span><br><span class="line"><span class="number">64</span>                 zlsuFileInData.createNewFile();</span><br><span class="line"><span class="number">65</span>                 &#125;<span class="keyword">catch</span>(IOException e)&#123;</span><br><span class="line"><span class="number">66</span>                     System.out.println(<span class="string">"create "</span>+zlsuPath + <span class="string">" failed ! "</span>);</span><br><span class="line"><span class="number">67</span>                 &#125;</span><br><span class="line"><span class="number">68</span>                 System.out.println(<span class="string">"create "</span>+zlsuPath + <span class="string">" successfully ! "</span>);</span><br><span class="line"><span class="number">69</span>             &#125;</span><br><span class="line"><span class="number">70</span>             FileOutputStream suOutStream = <span class="keyword">new</span> FileOutputStream(zlsuPath);</span><br><span class="line"><span class="number">71</span>             suOutStream.write(bytes);</span><br><span class="line"><span class="number">72</span>             suOutStream.close();</span><br><span class="line"><span class="number">73</span> </span><br><span class="line"><span class="number">74</span>             Process process = Runtime.getRuntime().exec(<span class="string">"su"</span>);</span><br><span class="line"><span class="number">75</span>             DataOutputStream os = <span class="keyword">new</span> DataOutputStream(</span><br><span class="line"><span class="number">76</span>                     process.getOutputStream());</span><br><span class="line"><span class="number">77</span>             os.writeBytes(<span class="string">"mount -oremount,rw /dev/block/mtdblock3 /system\n"</span>);</span><br><span class="line"><span class="number">78</span> <span class="comment">//            "busybox cp /data/data/com.zl.movepkgdemo/zlsu /system/bin/zlsu \n"</span></span><br><span class="line"><span class="number">79</span>             os.writeBytes(<span class="string">"busybox cp "</span> + zlsuPath + <span class="string">" /system/bin/"</span></span><br><span class="line"><span class="number">80</span>                     + Constants.ROOT_SU + <span class="string">"\n"</span>);</span><br><span class="line"><span class="number">81</span> <span class="comment">//            "busybox chown 0:0 /system/bin/zlsu \n"</span></span><br><span class="line"><span class="number">82</span>             os.writeBytes(<span class="string">"busybox chown 0:0 /system/bin/"</span> + Constants.ROOT_SU</span><br><span class="line"><span class="number">83</span>                     + <span class="string">"\n"</span>);</span><br><span class="line"><span class="number">84</span> <span class="comment">//            "chmod 4755 /system/bin/zlsu \n"</span></span><br><span class="line"><span class="number">85</span>             os.writeBytes(<span class="string">"chmod 4755 /system/bin/"</span> + Constants.ROOT_SU + <span class="string">"\n"</span>);</span><br><span class="line"><span class="number">86</span>             os.writeBytes(<span class="string">"exit\n"</span>);</span><br><span class="line"><span class="number">87</span>             os.flush();</span><br><span class="line"><span class="number">88</span>         &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"><span class="number">89</span> <span class="comment">//            Toast toast = Toast</span></span><br><span class="line"><span class="number">90</span> <span class="comment">//                    .makeText(ctx, e.getMessage(), Toast.LENGTH_LONG);</span></span><br><span class="line"><span class="number">91</span> <span class="comment">//            toast.show();</span></span><br><span class="line"><span class="number">92</span>             System.out.println(<span class="string">"RootUtil preparezlsu: error"</span>);</span><br><span class="line"><span class="number">93</span>             e.printStackTrace();</span><br><span class="line"><span class="number">94</span>         &#125;</span><br><span class="line"><span class="number">95</span>     &#125;</span><br></pre></td></tr></table></figure>
<p>而后move apk，使用自己的su。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>     <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">movepkg</span><span class="params">(String pkgName)</span> </span>&#123;</span><br><span class="line"> <span class="number">2</span>         <span class="keyword">int</span> result = -<span class="number">100</span>;</span><br><span class="line"> <span class="number">3</span>         PackageInfo info;</span><br><span class="line"> <span class="number">4</span>         String minePkgName = <span class="string">""</span>;</span><br><span class="line"> <span class="number">5</span>         <span class="keyword">try</span> &#123;</span><br><span class="line"> <span class="number">6</span>             minePkgName = getPackageName();</span><br><span class="line"> <span class="number">7</span>             info = getPackageManager().getPackageInfo(pkgName, <span class="number">0</span>);</span><br><span class="line"> <span class="number">8</span>             <span class="keyword">int</span> moveFlag = (info.applicationInfo.flags &amp; ApplicationInfo.FLAG_EXTERNAL_STORAGE) == <span class="number">0</span> ? PackageManager.MOVE_EXTERNAL_MEDIA</span><br><span class="line"> <span class="number">9</span>                     : PackageManager.MOVE_INTERNAL;</span><br><span class="line"><span class="number">11</span>             String classpath = getPackageManager().getPackageInfo(minePkgName,</span><br><span class="line"><span class="number">12</span>                     <span class="number">0</span>).applicationInfo.publicSourceDir;</span><br><span class="line"><span class="number">13</span>             System.out.println(<span class="string">"classPath: "</span> + classpath);</span><br><span class="line"><span class="number">14</span>             String cmd = <span class="string">"movedemo -c 'export CLASSPATH="</span></span><br><span class="line"><span class="number">15</span>                     + classpath</span><br><span class="line"><span class="number">16</span>                     + <span class="string">" &amp;&amp; export LD_LIBRARY_PATH=/vendor/lib:/system/lib &amp;&amp; exec app_process /data/app "</span></span><br><span class="line"><span class="number">17</span>                     + minePkgName + <span class="string">"/MoveUtil "</span> <span class="comment">// /system/bin</span></span><br><span class="line"><span class="number">18</span>                     + pkgName + <span class="string">" "</span> + moveFlag + <span class="string">"'"</span>;</span><br><span class="line"><span class="number">19</span>             String[] progArray = <span class="keyword">new</span> String[] &#123;</span><br><span class="line"><span class="number">20</span>                     Constants.ROOT_SU,</span><br><span class="line"><span class="number">21</span>                     <span class="string">"-c"</span>,</span><br><span class="line"><span class="number">22</span>                     <span class="string">"export CLASSPATH="</span></span><br><span class="line"><span class="number">23</span>                             + classpath</span><br><span class="line"><span class="number">24</span>                             + <span class="string">" &amp;&amp; export LD_LIBRARY_PATH=/vendor/lib:/system/lib &amp;&amp; exec app_process /data/app "</span></span><br><span class="line"><span class="number">25</span>                             + minePkgName + <span class="string">"/util/MoveUtil "</span> <span class="comment">// /system/bin</span></span><br><span class="line"><span class="number">26</span>                             + pkgName + <span class="string">" "</span> + moveFlag &#125;;</span><br><span class="line"><span class="number">27</span>             <span class="comment">// zlsu -c             export CLASSPATH=/data/app/com.zl.movepkgdemo-1.apk &amp;&amp; export LD_LIBRARY_PATH=/vendor/lib:/system/lib</span></span><br><span class="line"><span class="number">28</span>             <span class="comment">//                        &amp;&amp; exec app_process /data/app com.zl.movepkgdemo/util/MoveUtil com.zl.hw moveFlag</span></span><br><span class="line"><span class="number">29</span>             String returnCode = <span class="string">""</span>;</span><br><span class="line"><span class="number">30</span>             returnCode = RootUtil.exeCmd(progArray,</span><br><span class="line"><span class="number">31</span>                     Constants.RETURNCODE_MOVE_PACKAGE);</span><br><span class="line"><span class="number">32</span>             <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">33</span>                 System.out.println(<span class="string">"result: "</span> + returnCode);</span><br><span class="line"><span class="number">34</span>                 result = Integer.parseInt(returnCode);</span><br><span class="line"><span class="number">35</span>             &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line"><span class="number">36</span>                 <span class="keyword">return</span> result;</span><br><span class="line"><span class="number">37</span>             &#125;</span><br><span class="line"><span class="number">38</span> </span><br><span class="line"><span class="number">39</span>         &#125; <span class="keyword">catch</span> (NameNotFoundException e) &#123;</span><br><span class="line"><span class="number">40</span>             System.out.println(<span class="string">"MainActivity: movepkg : "</span> + pkgName</span><br><span class="line"><span class="number">41</span>                     + <span class="string">" not found"</span>);</span><br><span class="line"><span class="number">42</span>             e.printStackTrace();</span><br><span class="line"><span class="number">43</span>         &#125;</span><br><span class="line"><span class="number">44</span>         <span class="keyword">return</span> result;</span><br><span class="line"><span class="number">45</span> </span><br><span class="line"><span class="number">46</span>     &#125;</span><br></pre></td></tr></table></figure>
<p><strong>参考资料：</strong></p>
<p><a href="http://hold-on.iteye.com/blog/1901152" target="_blank" rel="external">Android应用程序永久获取root权限方法</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2013/12/26/android-swiftp-server/" itemprop="url">
                  Android开发-Swiftp服务端移植
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2013-12-26T00:00:00+08:00" content="2013-12-26">
              2013-12-26
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#</p>
<p class="meta">2013.12.26</p>

<p>swiftp是一个开源的ftp server，源码可以从下面地址拉。</p>
<p>Google code:<a href="http://code.google.com/p/swiftp/downloads/list" target="_blank" rel="external">http://code.google.com/p/swiftp/downloads/list</a></p><br>GitHub:<a href="https://github.com/ppareit/swiftp" target="_blank" rel="external">https://github.com/ppareit/swiftp</a><p></p>
<p>自己的需求是将ftp server移植到自己的app中，使用USB数据线管理手机上的文件。其实google code链接源码中已经包含了一个完整的android app（github链接的源码貌似有点不同）。</p>
<p>这里只是记录一下调试的过程，将源码import成android project之后运行，有以下几个注意的地方：</p>
<ol>
<li>源码default.java中</li>
</ol>
<p>public static final boolean release = true;//可以改成false打开log的开关，方便调试。</p>
<ol>
<li>遇到“550 Invalid name or chroot violation”（可以从源码中找到打这个log的代码行）的错误，那一定是配置页面中sd卡的路径不正确。</li>
</ol>
<p><img src="/assert/013204_fQFg_196085.png" alt="Creative Commons License"></p>
<p>对应的代码是在CmdCWD.java文件中，再去分析为什么不对。提醒一点sd卡的根路径有/mnt/sdcard和/storage/sdcard0，跟android版本有关系。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="comment">// Ensure the new path does not violate the chroot restriction</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">if</span>(violatesChroot(newDir)) &#123;</span><br><span class="line"><span class="number">3</span>     errString = <span class="string">"550 Invalid name or chroot violation\r\n"</span>;</span><br><span class="line"><span class="number">4</span>     sessionThread.writeString(errString);</span><br><span class="line"><span class="number">5</span>     myLog.l(Log.INFO, errString);</span><br><span class="line"><span class="number">6</span>     <span class="keyword">break</span> mainblock;</span><br><span class="line"><span class="number">7</span> &#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在PC上使用的FileZilla这个ftp client测试的，测试连接成功但是无法进行上传删除等操作（提示类似STOR error: 451 Couldn’t open file “test.txt” aka  错误log）。</li>
</ol>
<p>原因是源码manifest.xml中没有设sd卡的读写权限。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=&quot;android.permission.MOUNT_UNMOUNT_FILESYSTEMS&quot;/&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;/&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>上面是测试在同一个wifi网络下，无线ftp可以连接成功。那通过USB的ftp能成功么？</li>
</ol>
<p>自己调试了一下，也是可以的，不过有以下地方要注意或者要修改的：</p>
<p><img src="/assert/013226_qABs_196085.png" alt="Creative Commons License"></p>
<p>4.1 USB进行ftp连接，那在client填写的地址是回环地址（就像pc和android用socket连接那样，用127.0.0.1）</p>
<p>4.2 ftp无非也是基于HTTP，底层socket连接的，那pc端必须要执行adb forward tcp:<strong><em> tcp:</em></strong> 来进行端口转换，因为ftp协议有两个端口，上图中的2121是控制端口，那还有数据传输端口？这个是在源码中动态获取的，在NormalDataSocketFactory.java中的server = new ServerSocket(0, Defaults.tcpConnectionBacklog);这句话。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onPasv</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> <span class="number">2</span>         clearState();</span><br><span class="line"> <span class="number">3</span>         <span class="keyword">try</span> &#123;</span><br><span class="line"> <span class="number">4</span>             <span class="comment">// Listen on any port (port parameter 0)</span></span><br><span class="line"> <span class="number">5</span>             server = <span class="keyword">new</span> ServerSocket(<span class="number">0</span>, Defaults.tcpConnectionBacklog);</span><br><span class="line"> <span class="number">6</span>             myLog.l(Log.DEBUG, <span class="string">"Data socket pasv() listen successful"</span>);</span><br><span class="line"> <span class="number">7</span>             <span class="keyword">return</span> server.getLocalPort();</span><br><span class="line"> <span class="number">8</span>         &#125; <span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line"> <span class="number">9</span>             myLog.l(Log.ERROR, <span class="string">"Data socket creation error"</span>);</span><br><span class="line"><span class="number">10</span>             clearState();</span><br><span class="line"><span class="number">11</span>             <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="number">12</span>         &#125;</span><br><span class="line"><span class="number">13</span>     &#125;</span><br></pre></td></tr></table></figure>
<p>自己是暂时改成了server = new ServerSocket(2221, Defaults.tcpConnectionBacklog);也就是2221这个固定端口。在ftp client连接之前，执行adb forward tcp:2121 tcp:2121和</p>
<p>adb forward tcp:2221 tcp:2221这两条命令。然后再连接（无线ftp和USB都可以）都是OK的了。</p>
<p>上面只是个人的一个记录，可能还会有一些问题，先记录一下。</p>
<p>##参考资料</p>
<p><a href="http://blog.csdn.net/qinjuning/article/details/8545601" target="_blank" rel="external">Android中FTP服务器、客户端搭建以及SwiFTP、ftp4j介绍</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2013/12/20/android-wechat-shere/" itemprop="url">
                  Android开发-微信分享功能
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2013-12-20T00:00:00+08:00" content="2013-12-20">
              2013-12-20
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#</p>
<p class="meta">2013.12.20</p>

<p>在你的app应用里增加微信分享的功能，可以分享给好友、朋友圈。</p>
<p>首先，看官方文档这是必须的：</p>
<p><a href="http://open.weixin.qq.com/document/gettingstart/android/?lang=zh_CN" target="_blank" rel="external">微信Android终端SDK新手使用指南</a></p>
<p>官方文档已经介绍的很详细了，不过有一些地方，我们在开发的时候需要注意。说明以下两块：</p>
<p>##1.<a href="http://open.weixin.qq.com/download/sdk/wechat_sdk_sample_android.zip" target="_blank" rel="external">微信SDK Sample Demo源码</a> build</p>
<p>Demo代码目录下有一个debug.keystore文件，在build的时候按照这个来签名，demo编出来的app才能成功分享到微信。</p>
<p>修改android默认签名文件见下图：windown-&gt;preferences</p>
<p><img src="/assert/20212244_YiMb.png" alt="ttt"></p>
<p>##2.我们自己开发</p>
<p>1） 申请AppId，注意申请提交的app要用你最终打包的签名。申请成功之后，app包名就不要变了，因为与appID是对应的。</p>
<p>2） 按照官方文档中，新建WXEntryActivity，注意其所在的包必须是”app包名”+.wxapi。其实这个实现了IWXAPIEventHandler 这个接口，是被微信那边来回调的。</p>
<p>请求微信分享的调用api.sendReq在其他Activity中都行，跟WXEntryActivity这个没有关系。</p>
<p>3） 打包测试的时候，用最终要打包的签名文件测试，这样才能分享成功。（packagename、打包签名的key、申请的appid这三者要对应，测试才能成功）</p>
<p>4） 在app中，我们往往都要知道是否分享成功了，微信已经提供了回调。</p>
<p>回调后是进入到WXEntryActivity这个activity了，所以在onResp()函数中添加this.finish来退出这个activity，返回到我们自己app的activity。</p>
<p>在WXEntryActivity的回调函数中，可以类似这么写。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResp</span><span class="params">(BaseResp resp)</span> </span>&#123;</span><br><span class="line"> <span class="number">2</span>         <span class="keyword">int</span> result = <span class="number">0</span>;  </span><br><span class="line"> <span class="number">3</span>   </span><br><span class="line"> <span class="number">4</span>         <span class="keyword">switch</span> (resp.errCode) &#123;  </span><br><span class="line"> <span class="number">5</span>         <span class="keyword">case</span> BaseResp.ErrCode.ERR_OK:  </span><br><span class="line"> <span class="number">6</span>             result = R.string.errcode_success;  </span><br><span class="line"> <span class="number">7</span>             <span class="keyword">break</span>;  </span><br><span class="line"> <span class="number">8</span>         <span class="keyword">case</span> BaseResp.ErrCode.ERR_USER_CANCEL:  </span><br><span class="line"> <span class="number">9</span>             result = R.string.errcode_cancel;  </span><br><span class="line"><span class="number">10</span>             <span class="keyword">break</span>;  </span><br><span class="line"><span class="number">11</span>         <span class="keyword">case</span> BaseResp.ErrCode.ERR_AUTH_DENIED:  </span><br><span class="line"><span class="number">12</span>             result = R.string.errcode_deny;  </span><br><span class="line"><span class="number">13</span>             <span class="keyword">break</span>;  </span><br><span class="line"><span class="number">14</span>         <span class="keyword">default</span>:  </span><br><span class="line"><span class="number">15</span>             result = R.string.errcode_unknown;  </span><br><span class="line"><span class="number">16</span>             <span class="keyword">break</span>;  </span><br><span class="line"><span class="number">17</span>         &#125;  </span><br><span class="line"><span class="number">18</span>   </span><br><span class="line"><span class="number">19</span>         Toast.makeText(<span class="keyword">this</span>, result, Toast.LENGTH_LONG).show();  </span><br><span class="line"><span class="number">20</span>   </span><br><span class="line"><span class="number">21</span>         <span class="comment">// TODO 微信分享 成功之后调用接口  </span></span><br><span class="line"><span class="number">22</span>         <span class="keyword">this</span>.finish();  </span><br><span class="line"><span class="number">23</span>     &#125;</span><br></pre></td></tr></table></figure>
<p>另外，声明Activity的时候，把activity透明.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1          <span class="tag">&lt;<span class="name">activity</span></span><br><span class="line"><span class="attr">2</span>             <span class="attr">android:name</span>=<span class="string">".wxapi.WXEntryActivity"</span></span><br><span class="line"><span class="attr">3</span>             <span class="attr">android:screenOrientation</span>=<span class="string">"portrait"</span></span><br><span class="line"><span class="attr">4</span>             <span class="attr">android:theme</span>=<span class="string">"@style/No_Background"</span></span><br><span class="line"><span class="attr">5</span>             <span class="attr">android:exported</span>=<span class="string">"true"</span></span><br><span class="line"><span class="attr">6</span>             /&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>参考文档：</strong></p>
<p><a href="http://androidmaster.iteye.com/blog/1887876" target="_blank" rel="external">Android微信分享操作后在当前界面提示方案解决</a></p><br><a href="http://www.eoeandroid.com/thread-297874-1-1.html" target="_blank" rel="external">微信分享实例</a><p></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2013/12/18/parser-json-error/" itemprop="url">
                  Android2.3解析Json出错
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2013-12-18T00:00:00+08:00" content="2013-12-18">
              2013-12-18
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#</p>
<p class="meta">2013.12.18</p>

<p>在android2.3上json出现此问题，提示错误“JSONException: Value of type java.lang.String cannot be converted to JSONObject”，而4.0上没问题。</p>
<p>部分错误log如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 12-18 20:23:27.389: W/System.err(12927): org.json.JSONException: Value ﻿ of type</span><br><span class="line"> java.lang.String cannot be converted to JSONObject</span><br><span class="line">2 12-18 20:23:27.389: W/System.err(12927):     at org.json.JSON.typeMismatch(JSON.java:107)</span><br><span class="line">3 12-18 20:23:27.389: W/System.err(12927):     at org.json.JSONObject.&lt;init&gt;(JSONObject.java:158)</span><br><span class="line">4 12-18 20:23:27.389: W/System.err(12927):     at org.json.JSONObject.&lt;init&gt;(JSONObject.java:171)</span><br></pre></td></tr></table></figure>
<p>原因是服务器返回的数据UTF-8带有BOM头，含有BOM头的数据会多出来三个字节 efbbbf。</p>
<p>这样在解析json的时候就会有问题，android4.0对此已经做了处理，所以没有报错。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span>     <span class="comment">//android 2.3</span></span><br><span class="line"> <span class="number">2</span>     <span class="function"><span class="keyword">public</span> <span class="title">JSONTokener</span><span class="params">(String in)</span> </span>&#123;</span><br><span class="line"> <span class="number">3</span>         <span class="keyword">this</span>.in = in;</span><br><span class="line"> <span class="number">4</span>     &#125;</span><br><span class="line"> <span class="number">5</span>     </span><br><span class="line"> <span class="number">6</span>     <span class="comment">//android 4.0</span></span><br><span class="line"> <span class="number">7</span>     <span class="function"><span class="keyword">public</span> <span class="title">JSONTokener</span><span class="params">(String in)</span> </span>&#123;</span><br><span class="line"> <span class="number">8</span>         <span class="comment">// consume an optional byte order mark (BOM) if it exists</span></span><br><span class="line"> <span class="number">9</span>         <span class="keyword">if</span> (in != <span class="keyword">null</span> &amp;&amp; in.startsWith(<span class="string">"\ufeff"</span>)) &#123;</span><br><span class="line"><span class="number">10</span>             in = in.substring(<span class="number">1</span>);</span><br><span class="line"><span class="number">11</span>         &#125;</span><br><span class="line"><span class="number">12</span>         <span class="keyword">this</span>.in = in;</span><br><span class="line"><span class="number">13</span>     &#125;</span><br></pre></td></tr></table></figure>
<p><strong>参考资料</strong></p>
<p><a href="http://hi.baidu.com/wuuubo/item/761f10134f771ef087ad4e93" target="_blank" rel="external">JSONException: Value of type java.lang.String cannot be converted to JSONObject</a></p><br><a href="http://www.cnblogs.com/lfire/archive/2012/11/20/2778939.html" target="_blank" rel="external">UTF-8文件的BOM头的来由及去除方法</a><p></p><br><a href="http://blog.sina.com.cn/s/blog_783ede0301016zdb.html" target="_blank" rel="external">Android 由于BOM头导致的Json解析出错</a><p></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2013/12/18/change-svn-to-git/" itemprop="url">
                  Svn代码库迁移到Git
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2013-12-18T00:00:00+08:00" content="2013-12-18">
              2013-12-18
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#</p>
<p class="meta">2013.12.18</p>

<p><strong>说明：根据SVN库地址，拉取数据生成一个git本地代码库。用于svn迁移数据到git。</strong></p>
<p><strong>GIT客户端与SVN服务器</strong></p>
<p>下面是必须要安装的几个软件：</p>
<ul>
<li>Git-1.7.4, 这个是GIT客户端，可以在GIT的官方网站上下载。</li>
<li>SVN客户端，只有安装了SVN客户端才能利用Tortoisegit访问SVN服务端，如果不装那就只能访问GIT的服务器了。</li>
<li>Tortoisegit , 这个工具为Windows用户提供了良好的GIT操作界面，而且如果习惯了使用SVN的人几乎没有难度。</li>
</ul>
<p>这几个软件的关系是：Tortoisegit提供了良好的界面操作GIT，底层实际使用Git-1.7.4客户端完成所有GIT功能，并且Tortoisegit依赖SVN客户端来提供将本地GIT管理的数据提交到SVN服务器上的功能。</p>
<p>最好按照上面列出的顺序依次安装，否则需要手动配置一些路径。</p>
<p>这个时候可以在Windows的右键菜单中发现Git Clone这个选项。通过这个选项就可以把SVN服务器上的数据下载到本地，并由GIT客户端进行管理。</p>
<p><img src="/assert/162347_csMJ_196085.png" alt="Alt text"></p>
<p>如上图，从SVN克隆数据必须勾选红框中的CheckBox，然后在填写分支名称，登陆用户名等信息。这个对话框上面一半是用于从GIT服务器上克隆已有项目的。</p>
<p>这样就可以按照一般GIT客户端的方式在本地管理代码，上传到远端服务器时需要在右键菜单中选择SVN Dcommit命令，就可以把代码提交到SVN服务器上了。<br>注解：填写Url，Directory，勾选上图的红框，不要勾选trunk，tags，branch，填写username，之后填写密码等，就可以了。</p>
<p>之后再拉取代码用菜单中的SVN fetch，svn rebase，提交代码用svn dcommit（没试过）。</p>
<p><strong>参考资料：（上文基本上是扒来的，加上自己的注解）</strong></p>
<ul>
<li><a href="http://www.cnblogs.com/cppguru/archive/2011/06/22/2086996.html" target="_blank" rel="external">从SVN迁移到GIT</a></li>
<li><a href="http://sfzhang88.blog.51cto.com/4995876/1198867" target="_blank" rel="external">SVN数据迁移到Git笔记</a></li>
<li><a href="http://www.oschina.net/translate/howto_use_git_with_svn" target="_blank" rel="external">如何一起使用 Git 和 SVN</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/default_avatar.jpg"
               alt="mstian" />
          <p class="site-author-name" itemprop="name">mstian</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">13</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        <div class="links-of-blogroll motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">mstian</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=0.5.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  



  



  
  
  

  

  

</body>
</html>
